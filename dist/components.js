const componentCache = new Map(); async function loadComponent(file, elementId) { try { if (componentCache.has(file)) { document.getElementById(elementId).innerHTML = componentCache.get(file); initializeComponent(elementId); return; } const response = await fetch(file); if (!response.ok) throw new Error(`HTTP ${response.status}`); const data = await response.text(); componentCache.set(file, data); document.getElementById(elementId).innerHTML = data; initializeComponent(elementId); } catch (error) { console.error(`Erreur lors du chargement de ${file}:`, error); document.getElementById(elementId).innerHTML = `<div class="text-center py-8 text-gray-500">Erreur de chargement</div>`; } } function initializeComponent(elementId) { if (elementId === 'header') { initMobileMenu(); highlightActivePage(); initSmoothScrolling(); } } function initMobileMenu() { const navToggle = document.getElementById('nav-toggle'); const mobileNav = document.getElementById('mobile-nav'); const mobileClose = document.getElementById('mobile-close'); if (!navToggle || !mobileNav) return; const toggleMenu = () => { const isOpen = !mobileNav.classList.contains('translate-x-full'); if (isOpen) { mobileNav.classList.add('translate-x-full'); navToggle.classList.remove('active'); } else { mobileNav.classList.remove('translate-x-full'); navToggle.classList.add('active'); } }; navToggle.addEventListener('click', toggleMenu); if (mobileClose) { mobileClose.addEventListener('click', () => { mobileNav.classList.add('translate-x-full'); navToggle.classList.remove('active'); }); } mobileNav.addEventListener('click', (e) => { if (e.target.tagName === 'A') { mobileNav.classList.add('translate-x-full'); navToggle.classList.remove('active'); } }); document.addEventListener('click', (e) => { if (!mobileNav.contains(e.target) && !navToggle.contains(e.target)) { mobileNav.classList.add('translate-x-full'); navToggle.classList.remove('active'); } }); } function initSmoothScrolling() { document.addEventListener('click', (e) => { const link = e.target.closest('a[href^="#"]'); if (!link) return; e.preventDefault(); const targetId = link.getAttribute('href').substring(1); const target = document.getElementById(targetId); if (target) { target.scrollIntoView({ behavior: 'smooth', block: 'start' }); } }); } function highlightActivePage() { const currentPage = getCurrentPageName(); const navLinks = document.querySelectorAll('[data-page]'); navLinks.forEach(link => { const linkPage = link.getAttribute('data-page'); if (linkPage === currentPage) { if (link.classList.contains('after:content-[\'\']')) { link.classList.remove('text-gray-700', 'hover:text-primary'); link.classList.add('text-primary', 'font-medium', 'after:w-full'); } else { link.classList.remove('text-gray-900', 'font-medium'); link.classList.add('text-primary', 'font-semibold'); } } }); } function getCurrentPageName() { const path = window.location.pathname; const filename = path.split('/').pop() || 'index.html'; const pageMap = { 'index.html': 'index', 'nos-services.html': 'nos-services', 'notre-equipe.html': 'notre-equipe', 'faq.html': 'faq', 'mentions-legales.html': 'mentions-legales', 'demande-devis.html': 'demande-devis' }; return pageMap[filename] || 'index'; } document.addEventListener('DOMContentLoaded', async () => { try { await Promise.all([ loadComponent('header.html', 'header'), loadComponent('footer.html', 'footer') ]); } catch (error) { console.error('Erreur lors du chargement des composants:', error); } }); if ('serviceWorker' in navigator) { window.addEventListener('load', () => { const criticalComponents = ['header.html', 'footer.html']; criticalComponents.forEach(component => { if (!componentCache.has(component)) { fetch(component).then(response => response.text()) .then(data => componentCache.set(component, data)) .catch(() => {}); } }); }); }